<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NTA CUET Mock Portal</title>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <style>
        :root { --blue: #004a99; --green: #27ae60; --red: #e74c3c; }
        body { font-family: Arial; margin: 0; background: #f4f7f6; }
        .hidden { display: none !important; }
        .container { max-width: 800px; margin: 40px auto; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .nta-header { background: white; border-bottom: 2px solid var(--blue); padding: 10px 20px; display: flex; justify-content: space-between; }
        .palette-btn { width: 35px; height: 35px; margin: 3px; border: 1px solid #ccc; background: #fff; cursor: pointer; }
        .palette-btn.ans { background: var(--green); color: white; border-radius: 0 0 15px 15px; }
        .option-card { display: block; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

<div id="home-screen" class="container">
    <h2 style="color: var(--blue); text-align: center;">CUET UG LIVE PORTAL</h2>
    <div id="paper-list">Loading papers from cloud...</div>
    <button onclick="adminLogin()" style="margin-top:50px; opacity:0.1; border:none; background:none;">Admin</button>
</div>

<div id="admin-panel" class="container hidden">
    <h3>Admin: Upload New Test</h3>
    <input type="text" id="p-title" placeholder="Test Title" style="width:100%; padding:10px; margin-bottom:10px;">
    <textarea id="p-json" placeholder='JSON Format: [{"q":"Question?","options":["A","B","C","D"],"a":0}]' style="width:100%; height:150px;"></textarea>
    <button onclick="pushToCloud()" style="background:var(--blue); color:white; padding:10px; width:100%; border:none;">Publish Globally</button>
</div>

<div id="exam-screen" class="hidden">
    <div class="nta-header"><b>CUET MOCK</b><span id="timer">45:00</span></div>
    <div style="display:flex; height: 80vh;">
        <div style="flex:3; background:white; padding:30px;">
            <h4 id="q-num">Question 1</h4>
            <p id="q-text" style="font-size: 1.2rem;"></p>
            <div id="options-box"></div>
            <button onclick="saveNext()" style="background:var(--blue); color:white; padding:10px 20px; border:none; margin-top:20px;">Save & Next</button>
        </div>
        <div style="flex:1; background:#eee; padding:20px;">
            <b>Palette</b>
            <div id="palette-grid" style="margin:15px 0;"></div>
            <button onclick="submitTest()" style="background:var(--red); color:white; width:100%; border:none; padding:10px;">SUBMIT</button>
        </div>
    </div>
</div>

<div id="analysis-screen" class="container hidden">
    <h2>Detailed Performance Analysis</h2>
    <div id="score-summary" style="font-size:20px; margin-bottom:20px;"></div>
    <table border="1" style="width:100%; border-collapse: collapse;" id="analysis-table">
        <tr style="background:#eee;"><th>Q.No</th><th>Status</th><th>Correct Answer</th><th>Marks</th></tr>
    </table>
    <button onclick="location.reload()" style="width:100%; margin-top:20px; padding:10px;">Restart Practice</button>
</div>

<script>
    // --- STEP 2 Config goes here ---
    const firebaseConfig = {
        apiKey: "YOUR_KEY",
        databaseURL: "YOUR_URL",
        projectId: "YOUR_ID",
        appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let allTests = {}, activeTest = null, userAns = [], currentIdx = 0;

    // Load papers from Firebase
    db.ref('papers').on('value', (s) => {
        allTests = s.val() || {};
        const list = document.getElementById('paper-list');
        list.innerHTML = "";
        for(let id in allTests) {
            list.innerHTML += `<div style="border:1px solid #ddd; padding:15px; margin:10px 0; display:flex; justify-content:space-between;">
                <b>${allTests[id].title}</b>
                <button onclick="startTest('${id}')" style="background:var(--blue); color:white; border:none; padding:5px 15px;">Attempt</button>
            </div>`;
        }
    });

    function adminLogin() {
        if(prompt("Admin Password?") === "cuet123") {
            document.getElementById('home-screen').classList.add('hidden');
            document.getElementById('admin-panel').classList.remove('hidden');
        }
    }

    function pushToCloud() {
        const title = document.getElementById('p-title').value;
        const questions = JSON.parse(document.getElementById('p-json').value);
        db.ref('papers/' + Date.now()).set({ title, questions }).then(() => {
            alert("Test Published!");
            location.reload();
        });
    }

    function startTest(id) {
        activeTest = allTests[id];
        userAns = new Array(activeTest.questions.length).fill(null);
        document.getElementById('home-screen').classList.add('hidden');
        document.getElementById('exam-screen').classList.remove('hidden');
        render();
    }

    function render() {
        const q = activeTest.questions[currentIdx];
        document.getElementById('q-num').innerText = "Question " + (currentIdx + 1);
        document.getElementById('q-text').innerText = q.q;
        const box = document.getElementById('options-box');
        box.innerHTML = "";
        q.options.forEach((opt, i) => {
            box.innerHTML += `<label class="option-card"><input type="radio" name="opt" onclick="userAns[${currentIdx}]=${i}" ${userAns[currentIdx]===i?'checked':''}> ${opt}</label>`;
        });
        updatePalette();
    }

    function saveNext() {
        if(currentIdx < activeTest.questions.length - 1) { currentIdx++; render(); }
    }

    function updatePalette() {
        const grid = document.getElementById('palette-grid');
        grid.innerHTML = "";
        activeTest.questions.forEach((_, i) => {
            const cls = userAns[i] !== null ? 'palette-btn ans' : 'palette-btn';
            grid.innerHTML += `<button class="${cls}" onclick="currentIdx=${i};render()">${i+1}</button>`;
        });
    }

    function submitTest() {
        document.getElementById('exam-screen').classList.add('hidden');
        document.getElementById('analysis-screen').classList.remove('hidden');
        let score = 0, correct = 0, wrong = 0;
        const table = document.getElementById('analysis-table');

        activeTest.questions.forEach((q, i) => {
            let m = 0, status = "Skipped", color = "gray";
            if(userAns[i] === q.a) { score += 5; correct++; m = 5; status = "Correct"; color = "green"; }
            else if(userAns[i] !== null) { score -= 1; wrong++; m = -1; status = "Wrong"; color = "red"; }
            
            table.innerHTML += `<tr><td>${i+1}</td><td style="color:${color}">${status}</td><td>${q.options[q.a]}</td><td>${m}</td></tr>`;
        });
        document.getElementById('score-summary').innerHTML = `Final Score: <b>${score}</b> | Correct: ${correct} | Incorrect: ${wrong}`;
    }
</script>
</body>
</html>